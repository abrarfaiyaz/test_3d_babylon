<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babylon.js JSON Upload</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
    <canvas id="renderCanvas" style="width: 100%; height: 100%;"></canvas>
    <input type="file" id="fileInput" style="display: none;" accept=".json"/>
    <button id="uploadButton">Upload JSON</button>

    <script>
        // Create Babylon.js scene and engine
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);
        const scene = new BABYLON.Scene(engine);

        // Set up a camera
        const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 4, 10, new BABYLON.Vector3(0, 0, 0), scene);
        camera.attachControl(canvas, true);

        // Add lighting
        const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0), scene);
        light.intensity = 1;

        // Function to handle file upload and parsing
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const contents = e.target.result;
                const meshData = JSON.parse(contents);

                // Extract vertices and faces from the JSON file
                const vertices = meshData.vertices.flat(); // Flatten the vertices array
                const faces = meshData.faces.flat();       // Flatten the faces array

                // Create a new mesh in Babylon.js
                const customMesh = new BABYLON.Mesh("custom", scene);
                const vertexData = new BABYLON.VertexData();

                vertexData.positions = vertices;
                vertexData.indices = faces;

                // Apply vertex data to the mesh
                vertexData.applyToMesh(customMesh);

                // Set material with transparency
                const material = new BABYLON.StandardMaterial("material", scene);
                material.alpha = 0.5; // Set transparency
                material.diffuseColor = new BABYLON.Color3(0, 1, 0); // Green color for visibility
                customMesh.material = material;

                // Optionally scale and position the mesh
                customMesh.scaling = new BABYLON.Vector3(0.1, 0.1, 0.1);
                customMesh.position = new BABYLON.Vector3(0, 0, 0);

                // Render loop
                engine.runRenderLoop(function () {
                    scene.render();
                });
            };

            reader.readAsText(file); // Read the JSON file as text
        }

        // Trigger the file input when the button is clicked
        document.getElementById("uploadButton").addEventListener("click", function() {
            document.getElementById("fileInput").click();
        });

        // Handle file input change event (file selection)
        document.getElementById("fileInput").addEventListener("change", handleFileUpload);
    </script>
</body>
</html>
